# 4.8 AI编程工具实战

这一章不讲理论，直接上手主流AI编程工具。我会按照个人使用频率排序：Claude Code > Antigravity > Cursor > GitHub Copilot。每个工具都给一个完整的使用场景，你跟着做一遍，就能建立起自己的使用习惯。

## Claude Code 实战

Claude Code 是 Anthropic 出品的终端AI工具，也是我日常使用最多的。它没有GUI，完全在终端里操作。这看起来是劣势，但对于习惯命令行的工程师来说，反而效率更高——不用离开终端，直接在项目目录里跟AI对话。

### 安装与初始化

macOS, Linux, WSL:

```bash
curl -fsSL https://claude.ai/install.sh | bash
```

Windows PowerShell:

```powershell
irm https://claude.ai/install.ps1 | iex
```

Windows CMD:

```cmd
curl -fsSL https://claude.ai/install.cmd -o install.cmd && install.cmd && del install.cmd
```

开始使用 Claude Code：

```bash
cd your-project
claude
```

第一次运行会要求你登录 Anthropic 账号并授权。启动后Claude Code会自动扫描项目结构，读取CLAUDE.md（如果有的话）。

### CLAUDE.md 配置

CLAUDE.md是Claude Code最精髓的设计之一。它是一个Markdown文件，Claude Code每次启动时都会自动读取，相当于给AI一个持久的"项目记忆"。

在项目根目录创建 `CLAUDE.md`：

```markdown
# 项目概述

这是一个 Python FastAPI 后端服务，提供 REST API。

# 技术栈

- Python 3.12 + FastAPI
- SQLAlchemy 2.0 + PostgreSQL
- Pydantic v2 做数据校验
- pytest 做测试

# 关键约定

- 路由定义在 app/routers/ 下，按业务域拆分
- 数据库模型在 app/models/ 下
- Pydantic schema 在 app/schemas/ 下
- 所有 API 返回统一格式：{"code": 0, "data": ..., "message": "ok"}
- 数据库操作使用 async session

# 常用命令

- 启动服务：uvicorn app.main:app --reload
- 跑测试：pytest -v
- 类型检查：mypy app/
```

几个配置技巧：

- CLAUDE.md支持用`@path/to/file`语法导入其他文件，你可以把不同维度的规则拆分管理
- 可以在`~/.claude/CLAUDE.md`放全局配置（比如你所有项目通用的代码风格偏好）
- 子目录也可以有自己的CLAUDE.md，会跟上级的合并
- 运行`/init`命令可以让Claude Code自动生成一份初始CLAUDE.md
- 保持简洁，每一行都问自己："去掉这行Claude会犯错吗？"不会就删掉

### 终端内开发工作流

Claude Code 的核心优势是它能直接读写你的文件、运行命令、看报错输出。下面是一个真实的开发流程：

```
你: 帮我实现一个用户注册接口。要求：
    - POST /api/v1/auth/register
    - 接收 email、password、nickname
    - 密码用 bcrypt 哈希
    - email 不能重复，重复返回 409
    - 注册成功返回用户信息（不含密码）

Claude Code: [会自动查看项目结构，然后依次创建/修改以下文件]
    - app/schemas/auth.py (请求和响应的Schema)
    - app/models/user.py (如果不存在的话)
    - app/routers/auth.py (路由定义)
    - app/routers/__init__.py (注册路由)

你: 跑一下测试看看有没有问题

Claude Code: [执行 pytest，如果有报错会自动分析并修复]
```

### Agent Teams（蜂群模式）实战

这是2026年2月随Opus 4.6发布的重磅功能。启用方式：

```bash
# 方式1：在 ~/.claude/settings.json 中配置
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}

# 方式2：直接设置环境变量
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
```

启用后，Claude Code会获得TeammateTool能力。你只需要在Prompt中指示使用团队协作：

```
你: 我们的项目需要做以下三件事，请分配给团队成员并行处理：
    1. 给 UserService 添加批量导入功能，包含CSV解析和数据校验
    2. 给现有的 /api/users 接口添加分页、排序、筛选支持
    3. 为上述两个功能编写完整的单元测试和集成测试

Claude Code (Team Lead): [制定计划，创建3个Teammate]
    → Teammate 1: 在独立worktree中实现批量导入功能
    → Teammate 2: 在独立worktree中实现API查询增强
    → Teammate 3: 等前两个完成后编写测试
```

每个Teammate在独立的Git Worktree中工作，互不冲突。Team Lead负责协调和最终合并。需要注意的是Agent Teams的Token消耗大约是单Agent的7倍，适合用在大型任务上。

### 分步引导技巧

处理复杂任务时，不要一次丢一大坨需求。分步来：

```
第一步: 先帮我梳理一下 app/services/order.py 里的 create_order 函数，
       说说它现在的逻辑流程和潜在问题。

第二步: [看完分析后] 好，现在帮我重构这个函数：
       - 把库存检查抽成独立方法
       - 加上分布式锁防并发
       - 用事务保证数据一致性

第三步: 给重构后的代码写单元测试，覆盖正常下单、库存不足、并发下单三个场景。
```

分步做的好处是每一步你都能review，发现方向不对可以及时纠正。

## Google Antigravity 实战

Antigravity是Google的"Agent-First" IDE，2025年底发布，目前免费公测。

### 安装与上手

从 antigravityai.org 下载安装。用个人Gmail账号登录即可使用，公测期间Gemini 3 Pro的额度很慷慨。

启动后你会看到它跟VS Code很像的界面，但多了一个关键入口：**Manager View**。这是Antigravity的核心差异——你不是在跟一个AI助手对话，而是在管理一支AI团队。

### Manager View 多Agent并行

在Manager View里，你可以同时派出多个Agent：

```
任务: 我们的项目有5个bug需要修复，分别在不同模块。
请分配5个Agent并行处理：
1. Bug #123: 登录页面在移动端布局错位
2. Bug #124: 搜索接口超时未做降级处理
3. Bug #125: 导出Excel中文乱码
4. Bug #126: 缓存未在更新时失效
5. Bug #127: 日期选择器时区转换错误
```

Antigravity会为每个任务创建一个Agent，你可以在Manager View里实时看到每个Agent的进度。

### 反馈机制

Antigravity的一个独特设计：你可以直接在Agent生成的代码上加"批注"（类似Google Docs的评论），Agent会即时读取反馈并调整，不需要重新开始整个任务。

比如Agent生成了一个函数，你觉得错误处理不够完善，直接在那段代码旁边批注"这里需要处理连接超时的情况"，Agent会立刻更新那部分代码。

## Cursor 深度实战

Cursor 是目前体验最完整、最稳定的AI编辑器，基于 VS Code 深度改造。

### 项目级上下文配置

Cursor 最被低估的功能是 `.cursorrules` 文件。它相当于给AI一份项目说明书，每次对话都会自动带上。

在项目根目录创建 `.cursorrules`：

```
# 项目信息
这是一个 React + TypeScript 前端项目，使用 Next.js 14 App Router。
状态管理使用 Zustand，样式用 Tailwind CSS。

# 代码规范
- 组件使用函数式组件 + hooks
- 文件命名用 kebab-case，组件命名用 PascalCase
- API 请求统一走 src/lib/api.ts 里的封装
- 不要使用 any 类型，必须给出明确的类型定义
- 错误处理使用 try-catch，不要用 .catch()

# 项目结构
src/
  app/          # Next.js App Router 页面
  components/   # 可复用组件
  lib/          # 工具函数和API封装
  hooks/        # 自定义 hooks
  types/        # TypeScript 类型定义
  stores/       # Zustand stores

# 偏好
- 生成代码时附带简要的行内注释
- 新建组件时同时生成对应的类型文件
- 使用 zod 做运行时类型校验
```

另一个技巧：在Chat或Composer里用 `@` 符号引用项目文件。`@src/lib/api.ts` 把文件内容喂给AI，`@Docs` 可以引用外部文档链接。

### 多模式协作

Cursor有四种AI交互模式：

**Tab补全** — 写代码时自动触发，按Tab接受。适合写重复性代码、补全函数体、续写逻辑。

**Cmd+K（内联编辑）** — 选中一段代码按Cmd+K，输入指令直接修改。比如选中一个fetch调用，输入"加上重试逻辑，最多3次，间隔指数递增"。

**Chat（侧边栏）** — 按Cmd+L打开。适合提问、讨论方案、理解代码。

**Composer（多文件编辑）** — 按Cmd+I打开。这是Cursor的杀手锏，能同时创建和修改多个文件。Agent模式下还能读取终端输出，自动修复错误。

### Agent模式多文件重构实操

假设你要把项目里所有的 `axios` 调用换成 `fetch` + 自定义封装：

打开 Composer（Cmd+I），切换到Agent模式，输入：

```
把项目中所有使用 axios 的地方替换为 src/lib/api.ts 里的自定义 fetch 封装。
具体要求：
1. 先看一下 @src/lib/api.ts 现有的封装
2. 找出所有 import axios 的文件
3. 逐个替换，保持原有的错误处理逻辑
4. 最后移除 package.json 里的 axios 依赖
```

Agent会自动搜索文件、分析依赖关系、逐个修改。改完后一定要跑测试和类型检查。

## GitHub Copilot 实战

Copilot 是最老牌的AI编程工具，Tab补全体验很丝滑。

### 注释驱动开发

Copilot 最高效的用法是先写注释描述你要什么，然后让它生成代码：

```typescript
// 将扁平的部门数组转换为树形结构
// 输入: Department[] 其中每个部门有 id, name, parentId
// 输出: DepartmentTree[] 其中每个节点有 children 数组
// parentId 为 null 的是根节点
function buildDepartmentTree(departments: Department[]): DepartmentTree[] {
  // Copilot 会在这里自动补全函数实现
}
```

注释写得越精确，生成的代码质量越高。把输入输出、边界条件写清楚，Copilot基本能一次生成正确的实现。

### 测试生成

在测试文件里写注释描述场景，Copilot会逐个生成测试用例：

```typescript
// 测试 buildDepartmentTree 函数
// 场景1: 空数组返回空数组
// 场景2: 单个根节点，无子节点
// 场景3: 多层嵌套结构
// 场景4: parentId 指向不存在的部门

describe("buildDepartmentTree", () => {
  // Copilot 会逐个生成测试用例
});
```

## 完整场景示例

**Claude Code 场景：排查线上bug + Agent Teams大重构**

在终端里告诉Claude Code："用户反馈下单后偶尔出现重复扣款。帮我查一下 app/services/payment.py 和 app/services/order.py，分析可能的并发问题，然后给出修复方案。" Claude Code会阅读代码、定位问题、直接给你改好。需要大规模重构时，开启Agent Teams让多个Teammate并行处理不同模块。

**Antigravity 场景：多bug并行修复**

在Manager View里列出5个独立的bug，Antigravity分配5个Agent并行修复，你可以实时查看每个Agent的进度并通过批注反馈。

**Cursor 场景：从设计稿实现页面**

打开Composer，输入需求描述并粘贴设计稿截图，Cursor一次性生成多个文件——组件、类型、表单校验规则。

**Copilot 场景：快速实现工具函数**

在 utils.ts 里写注释描述需求，Tab接受补全。30秒搞定一个工具函数+测试。

## 选择建议

- **Claude Code 作为核心工具**：项目级任务、大规模重构、Agent Teams并行开发
- **Antigravity 用于探索**：日常编码、多文件修改
- **Cursor 作为日常编辑器**：日常编码、多文件修改、设计稿转代码
- **Copilot 作为补充**：团队统一用VS Code且已有许可证时，做代码补全

四个工具不互斥，根据场景灵活切换就好。
